name: Go

on:
  schedule:
  - cron: '15 4/12 * * *'
  watch:
    types: [started]

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:  
    
    - name: Get config.yaml.example
      run: wget https://raw.githubusercontent.com/hb0nes/epic-store-free-games-snatcher/main/config.yaml.example
      
    - name: "Configure config.yaml"
      run: |
        mv config.yaml.example config.yaml
        sed -i '/FOR_EXAMPLE/d' config.yaml
        sed -i 's|<hCAPTCHA_ACCESSIBILITY_URL>|${{ secrets.hCaptchaURL }}|' config.yaml
        sed -i 's|<EPIC_GAMES_STORE_USERNAME>|${{ secrets.username }}|' config.yaml
        sed -i 's|<EPIC_GAMES_STORE_PASSWORD>|${{ secrets.password }}|' config.yaml
        sed -i 's|<EPIC_GAMES_STORE_OTPSECRET>|${{ secrets.OTPSecret }}|' config.yaml
        sed -i 's|<TELEGRAM_ID>|${{ secrets.telegramID }}|' config.yaml
        sed -i 's|<IMGUR_CLIENT_ID>|${{ secrets.IMGUR_CLIENT_ID }}|' config.yaml
        sed -i 's|<IMGUR_SECRET>|${{ secrets.IMGUR_SECRET }}|' config.yaml
        sed -i 's|<IMGUR_REFRESH_TOKEN>|${{ secrets.IMGUR_REFRESH_TOKEN }}|' config.yaml
        
    - name: Run Docker container
      run:  docker run -v ${PWD}/config.yaml:/go/yoink/config.yaml b0nes/epic-games-yoinker:latest
