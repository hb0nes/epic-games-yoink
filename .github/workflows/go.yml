name: Go

on:
  schedule:
  - cron: '15 4/12 * * *'
  watch:
    types: [started]

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:  
    
    - name: Get config.yaml.example
      run: wget https://raw.githubusercontent.com/hb0nes/epic-store-free-games-snatcher/main/config.yaml.example
      
    - name: "Configure config.yaml"
      run: |
        mv config.yaml.example config.yaml
        sed -i '/FOR_EXAMPLE/d' config.yaml
        sed -i 's|<hCAPTCHA_ACCESSIBILITY_URL>|${{ secrets.hCaptchaURL }}|' config.yaml
        sed -i 's|<EPIC_GAMES_STORE_USERNAME>|${{ secrets.username }}|' config.yaml
        sed -i 's|<EPIC_GAMES_STORE_PASSWORD>|${{ secrets.password }}|' config.yaml
        sed -i 's|<EPIC_GAMES_STORE_OTPSECRET>|${{ secrets.OTPSecret }}|' config.yaml
        sed -i 's|<TELEGRAM_ID>|${{ secrets.telegramID }}|' config.yaml
        sed -i 's|<IMGUR_CLIENT_ID>|${{ secrets.IMGUR_CLIENT_ID }}|' config.yaml
        sed -i 's|<IMGUR_SECRET>|${{ secrets.IMGUR_SECRET }}|' config.yaml
        sed -i 's|<IMGUR_REFRESH_TOKEN>|${{ secrets.IMGUR_REFRESH_TOKEN }}|' config.yaml
        
    - name: Run Docker container
      run:  docker run -v ${PWD}/config.yaml:/go/yoink/config.yaml --network host b0nes/epic-games-yoinker:latest
   
#     - name: Download & Install Chrome
#       run: sudo apt update && sudo apt install -y google-chrome-stable scrot xvfb

#     - name: Set up Go 1.x
#       uses: actions/setup-go@v2
#       with:
#         go-version: ^1.15.2

#     - name: Check out code into the Go module directory
#       uses: actions/checkout@v2
#       with:
#         repository: 'hb0nes/epic-store-free-games-snatcher'
      
#     - name: Get dependencies
#       run: |
#         go get -v -t -d ./...
#         if [ -f Gopkg.toml ]; then
#             curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
#             dep ensure
#         fi

        
#     - name: Build!
#       run: go build -o games-be-yoinked
      
#     - name: Information
#       run: pwd; ls -lrth; id; whoami; cat ./config.yaml
      
#     - name: Run! 
#       run: Xvfb :99 -screen 0 1024x768x16 & DISPLAY=:99 ./games-be-yoinked
#       uses: GabrielBB/xvfb-action@v1
#       with:
#         run: ./games-be-yoinked
